<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Dashboard | Uplon - Responsive Bootstrap 4 Admin Dashboard</title>
    <th:block th:replace="/dashboard/layout/header::header"/>
</head>

<body>

<!-- Begin page -->
<div id="wrapper">


    <!-- Topbar Start -->
    <th:block th:replace="/dashboard/layout/navbar/navbar::navbar"/>
    <!-- end Topbar -->


    <!-- ========== Left Sidebar Start ========== -->
    <th:block th:replace="/dashboard/layout/left-side-menu::left-side-menu"/>
    <!-- Left Sidebar End -->

    <!-- ============================================================== -->
    <!-- Start Page Content here -->
    <!-- ============================================================== -->

    <div class="content-page">
        <div class="content">
            <div class="container-fluid">

                <div class="row shadow-lg p-2 mb-5 bg-body rounded" style="margin-top: 10px">
                    <div class="col-md-7">
                        <h6><a href="/user-dashboard">Quay lại danh sách khách hàng</a></h6>
                    </div>
                    <div class="col-md-5">

                        <button type="button" style="margin-bottom: 10px;margin-right: 10px;"
                                class="btn btn-danger float-right btn-delete">
                            <i class="fas fa-trash"></i>
                            Xoá khách hàng
                        </button>
                    </div>
                </div>

                <div class="row" style="top: -25px; position: relative;">
                    <div class="col-md-12" style="margin-top: -15px;">
                        <h4>Khách Hàng</h4>
                    </div>
                </div>

                <div class="row shadow-lg p-3 mb-5 bg-body rounded" style="top: -25px; position: relative;">

                    <th:block th:each="customerInfo, count : ${customerInfo}">

                        <div class="col-md-6">
                            <h6>Thông tin cá nhân</h6>
                        </div>
                        <div class="col-md-6">
                            <button type="button" style="margin-bottom: 10px"
                                    class="btn btn-warning float-right btnUpdate">Cập nhật
                            </button>
                        </div>
                        <input type="hidden" id="idCustomer" name="id" th:field="*{customerInfo.id}">

                        <div class="col-md-6">
                            <label>Tên khách hàng:</label>
                            <p th:text="*{customerInfo.fullName}"></p>
                        </div>
                        <div class="col-md-6">
                            <label>Số điện thoại:</label>
                            <p th:text="*{customerInfo.phone}"></p>
                        </div>
                        <div class="col-md-6">
                            <label>Email:</label>
                            <p th:text="*{customerInfo.userName}"></p>
                        </div>
                        <div class="col-md-6">
                            <label>Thành phố:</label>
                            <p th:text="*{customerInfo.locationRegion.provinceName}"></p>
                        </div>
                        <div class="col-md-6">
                            <label>Quận/huyện:</label>
                            <p th:text="*{customerInfo.locationRegion.districtName}"></p>
                        </div>
                        <div class="col-md-6">
                            <label>Địa chỉ:</label>
                            <p th:text="*{customerInfo.locationRegion.address}"></p>
                        </div>

                    </th:block>

                    <!--          <div class="col-md-12">-->
                    <!--          </div>-->

                </div>

                <div class="row" style="top: -25px; position: relative;">
                    <div class="col-md-12">
                        <div class="row shadow-lg p-3 mb-5 bg-body rounded">
                            <div class="col-md-6">
                                <h6>Thông tin mua hàng</h6>

                            </div>

                            <div class="col-md-6">
                                <button type="button" style="margin-bottom: 10px"
                                        class="btn btn-primary float-right ">Chi tiết
                                </button>
                            </div>
                            <div class="col-md-6">
                                <label>Tổng chi tiêu:</label>
                            </div>
                            <div class="col-md-6">
                                <label>Tổng SL sản phẩm đã mua:</label>
                            </div>
                            <div class="col-md-6">
                                <label>Tổng SL đơn hàng:</label>
                            </div>
                            <div class="col-md-6">
                                <label>Tổng SL sản phẩm hoàn trả:</label>
                            </div>

                        </div>

                    </div>
                    <div class="col-md-5" style="  padding-left: 35px;">
                        <div class="row ">

                        </div>

                    </div>

                </div>

            </div>


        </div>
        <!-- Start Content-->

    </div> <!-- end content -->


    <!-- Footer Start -->
    <th:block th:replace="/dashboard/layout/footer::footer"/>
    <!-- end Footer -->

</div>

<!-- ============================================================== -->
<!-- End Page content -->
<!-- ============================================================== -->

</div>
<!-- END wrapper -->

<!-- Right Sidebar -->

<!-- Vendor js -->
<th:block th:replace="/dashboard/layout/script/script::script"/>

<th:block th:replace="/dashboard/userDashboard/modalupdate-user :: modal_update"/>

<script>

    let page = {
        url: {
            CreateCustomerInfo: App.BASE_URL_CUSTOMERINFO,
            getAllCustomerInfo: App.BASE_URL_CUSTOMERINFO,
            getAllProvinces: App.BASE_URL_PROVINCE + "/",
            getAllDistricts: App.BASE_URL_PROVINCE + "/district/",
            DeleteCustomer: App.BASE_URL_CUSTOMERINFO + "/delete-soft-customer/"


        },
        element: {},
        loadData: {},
        commands: {},
        dialogs: {
            element: {},
            loadData: {},
            commands: {},
            close: {},
            alertDanger: {},
            inputError: {}
        }
    }

    page.element.fullNameUp = $("#fullNameUp");
    page.element.phoneUp = $("#phoneUp");
    page.element.emailUp = $("#emailUp");
    page.element.provinceUp = $("#provinceUp");
    page.element.provinceText = $("#provinceUp :selected");
    page.element.districtUp = $("#districtUp");
    page.element.districText = $("#districtUp :selected");
    page.element.addressUp = $("#addressUp");
    page.element.idCustomer = $("#idCustomer")

    page.element.btnUpdateCustomer = $(".btnUpdate")
    page.element.btnDelete = $(".btn-delete")


    let customerInfo = new CustomerInfo();
    let locationRegion = new LocationRegion();
    let user = new User();
    let customerInfoId = null;


    page.dialogs.commands.getCustomerInfoById = (id) => {
        return $.ajax({
            "method": "GET",
            "url": page.url.getAllCustomerInfo + "/" + id
        }).done((data) => {
            customerInfo = data;
        })
    }

    page.dialogs.commands.goModalUpdateCustomer = () => {
        page.element.btnUpdateCustomer.on('click', function () {
            page.dialogs.commands.getCustomerInfoById(page.element.idCustomer.val()).then(() => {

                page.element.fullNameUp.val(customerInfo.fullName)
                page.element.emailUp.val(customerInfo.userName)
                page.element.phoneUp.val(customerInfo.phone)

                page.element.provinceUp.val(customerInfo.locationRegion.provinceId)
                page.element.addressUp.val(customerInfo.locationRegion.address)

                page.dialogs.commands.drawDistricts(customerInfo.locationRegion.provinceId).then(function () {

                    page.element.districtUp(customerInfo.locationRegion.districtId);
                })
                $('#modalUpdateUser').modal('show')

            })
        })

    }

    page.dialogs.commands.drawProvinces = () => {
        return $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "GET",
            "url": "https://vapi.vnappmob.com/api/province/"
        })
            .done((data) => {
                console.log(data)
                page.element.provinceUp.html("")
                $.each(data.results, (i, item) => {
                    console.log(item)
                    let str = `<option value="${item.province_id}">${item.province_name}</option>`;
                    page.element.provinceUp.append(str);
                })
            })
            .fail((jqxHR) => {
                console.log(jqxHR);
            })
    }

    page.dialogs.commands.drawDistricts = (provinceId) => {
        return $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "GET",
            "url": "https://vapi.vnappmob.com/api/province/district/" + provinceId
        }).done((data) => {
            if (data.results.length === 0) {
                App.IziToast.showErrorAlert("Loading of districts is fail");
            } else {
                page.element.districtUp.html("");
                $.each(data.results, (i, item) => {
                    let str = `<option  class="form-control" value="${item.district_id}">${item.district_name}</option>`;

                    page.element.districtUp.append(str)
                })
            }
        }).fail((jqXHR) => {
            console.log(jqXHR);
        })
    }

    page.element.provinceUp.on('change', function () {
        page.dialogs.commands.drawDistricts(page.element.provinceUp.val())
    })
    page.commands.handleshowConfirmDelete = () => {
        page.element.btnDelete.on('click', function () {
            App.SweetAlert.showConfirmDeleteUser()
                .then((result) => {
                    if (result.isConfirmed) {

                            $.ajax({
                            "headers": {
                                "accept": "application/json",
                                "content-type": "application/json"
                            },
                            "type": "DELETE",
                            "url": "http://localhost:8092/api/customerInfo/delete-soft-customer/" + page.element.idCustomer.val(),
                            "data": JSON.stringify(customerInfo)
                        })
                            .done(() => {
                                App.SweetAlert.showSuccessAlert("Xóa khách hàng Thành Công")
                                setTimeout(function () {
                                    App.SweetAlert.showSuccessAlert("Bạn sẽ trở về danh sách khách hàng sau 4s")
                                    window.location.href = "/user-dashboard";
                                }, 4000);
                            })
                            .fail(() => {
                                App.SweetAlert.showErrorAlert('Xóa khách hàng thất bại');
                            });
                    }
                })
        })
    }
    $(function () {
        page.dialogs.commands.goModalUpdateCustomer();
        page.dialogs.commands.getCustomerInfoById();
        page.dialogs.commands.drawProvinces().then(() => {
            page.dialogs.commands.drawDistricts(page.element.provinceUp.val());
        })
        page.commands.handleshowConfirmDelete();
    })


</script>

</body>
</html>