<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Dashboard | Uplon - Responsive Bootstrap 4 Admin Dashboard</title>
    <th:block th:replace="/dashboard/layout/header::header"/>
</head>

<body>

<!-- Begin page -->
<div id="wrapper">


    <!-- Topbar Start -->
    <th:block th:replace="/dashboard/layout/navbar/navbar::navbar"/>
    <!-- end Topbar -->


    <!-- ========== Left Sidebar Start ========== -->
    <th:block th:replace="/dashboard/layout/left-side-menu::left-side-menu"/>
    <!-- Left Sidebar End -->

    <!-- ============================================================== -->
    <!-- Start Page Content here -->
    <!-- ============================================================== -->

    <div class="content-page">
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box">
                            <div class="page-title-right">
                                <ol class="breadcrumb m-0">
                                    <li class="breadcrumb-item"><a href="javascript: void(0);">Uplon</a></li>
                                    <li class="breadcrumb-item active">Category</li>
                                </ol>
                            </div>
                            <h4 class="page-title">Màu sắc sản phẩm</h4>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-8">
                    </div>

                </div>


                <div class="row">
                    <div class="col-md-4">
                        <div class="row">
                            <h3>Thêm mới màu sắc sản phẩm</h3>
                        </div>
                        <div class="row">
                            <label>Tên màu sắc sản phẩm</label>
                            <input type="text" class="form-control" id="nameColor" name="nameColor"
                                   placeholder="Nhập màu sắc sản phẩm">
                        </div>

                        <div class="row">
                            <button type="button" style="margin-bottom: 10px;margin-top: 10px"
                                    class="btn btn-success float-right createColor " id="createColor">
                                <i class="fas fa-plus-square" style="margin-right: 5px;"></i>Tạo mới
                            </button>
                        </div>

                    </div>

                    <div class=" col-md-8">
                        <div class="row">
                            <div class="col-12">
                                <div class="card-box">
                                    <h2 class="header-title">Danh sách màu sắc sản phẩm</h2>

                                    <table id="key-table"
                                           class="table table-bordered dt-responsive nowrap tableListOrder"
                                           style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead>
                                        <tr>
                                            <th class="text-center align-middle">#</th>
                                            <th class="text-center align-middle">Tên màu sắc sản phẩm</th>
                                            <th class="text-center align-middle">Hành động</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <th:block th:each="color, count : ${color}">
                                            <tr>
                                                <td class="text-center align-middle" id="idColor" name="id"th:text="*{color.id}"></td>
                                                <td class="text-center align-middle" th:text="*{color.color}"></td>
                                                <td class="text-center align-middle" style="width: 0">
                                                    <button th:data-id="*{color.id}" type="button" style="text-align: center; position: relative;left: -25px;"
                                                            class="btn btn-danger float-right btn-delete btnDeleteColor">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </th:block>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!-- Start Content-->


        </div>
    </div> <!-- end content -->


    <!-- Footer Start -->
    <th:block th:replace="/dashboard/layout/footer::footer"/>
    <!-- end Footer -->

</div>

<!-- ============================================================== -->
<!-- End Page content -->
<!-- ============================================================== -->

</div>
<!-- END wrapper -->

<!-- Right Sidebar -->

<!-- Vendor js -->
<th:block th:replace="/dashboard/layout/script/script::script"/>
<script src="/assets_dashboard/assets/libs/datatables/jquery.dataTables.min.js"></script>
<script src="/assets_dashboard/assets/libs/datatables/dataTables.bootstrap4.min.js"></script>
<script src="/assets_dashboard/assets/js/pages/datatables.init.js"></script>


<script>
    let page = {
        url: {
            CreateColor: App.BASE_URL_COLOR,
            DeleteColor: App.BASE_URL_COLOR + "/delete-color/"

        },
        element: {},
        loadData: {},
        commands: {},
        dialogs: {
            element: {},
            loadData: {},
            commands: {},
            close: {},
            alertDanger: {},
            inputError: {}
        }
    }
    page.element.nameColor = $("#nameColor");
    page.element.btncreateColor = $("#createColor");
    page.element.btnDeleteColor = $(".btnDeleteColor");
    page.element.idColor = $("#idColor");

    let productColor = new ProductColor();

    let colorId = null;

    page.element.btncreateColor.on('click', () => {
        productColor.color = page.element.nameColor.val();
        delete productColor.id;

        $.ajax({
            "headers": {
                "accept": "application/json",
                "content-type": "application/json"
            },
            "type": "POST",
            "url": "http://localhost:8092/api/colorProduct/create",
            "data": JSON.stringify(productColor)
        }).done((data) => {
            productColor.color = page.element.nameColor.val("");

            Swal.fire({
                icon: 'success',
                title: "Thêm mới màu sắc thành công",
                position: 'top-end',
                showConfirmButton: false,
                timer: 1500
            })
            setTimeout(function () {
                window.location.href = "/color-product-dashboard";
            }, 1000);
        }).fail((jqXHR) => {
            App.IziToast.showErrorAlert("Thêm mới màu sắc thất bại")
            console.log(jqXHR)
        })
    })
    page.commands.handleShowConfirmDeleteColor = () => {
        page.element.btnDeleteColor.on('click', function () {
            let  id = $(this).data("id");
            App.SweetAlert.showConfirmDeleteColor()
                .then((result) => {
                    if (result.isConfirmed) {

                        $.ajax({
                            "type": "DELETE",
                            url: page.url.DeleteColor + id,
                        })
                            .done((data) => {
                                console.log(data)
                                Swal.fire({
                                    icon: 'success',
                                    title: "Xóa màu sắc sản phẩm Thành Công! Bạn sẽ trở về danh sách màu sắc sản phẩm sau 1s",
                                    position: 'top-end',
                                    showConfirmButton: false,
                                    timer: 1500
                                })
                                setTimeout(function () {
                                    window.location.href = "/color-product-dashboard";
                                }, 1000);
                            })
                            .fail((e) => {
                                console.log(e)
                                App.IziToast.showErrorAlert('Xóa màu sắc sản phẩm  thất bại');
                            });
                    }
                })
        })
    }
    $(function () {

        page.commands.handleShowConfirmDeleteColor();


    })
</script>
</body>
</html>